<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Process Yield Calculator ‚Äî Lean Six Sigma</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&family=Fraunces:wght@700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --bg-soft: #f8fafc;
    --bg-card: #ffffff;
    --bg-input: #f1f5f9;
    --bg-input-focus: #e8f4f8;
    --border: #e2e8f0;
    --border-strong: #cbd5e1;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 30px rgba(0,0,0,0.08), 0 4px 8px rgba(0,0,0,0.04);
    --shadow-xl: 0 20px 50px rgba(0,0,0,0.1);
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-muted: #94a3b8;
    --text-label: #334155;
    --cyan: #0891b2;
    --cyan-light: #ecfeff;
    --cyan-mid: #22d3ee;
    --cyan-dark: #155e75;
    --violet: #7c3aed;
    --violet-light: #f5f3ff;
    --violet-mid: #a78bfa;
    --amber: #d97706;
    --amber-light: #fffbeb;
    --amber-mid: #fbbf24;
    --emerald: #059669;
    --emerald-light: #ecfdf5;
    --rose: #e11d48;
    --rose-light: #fff1f2;
    --blue: #2563eb;
    --blue-light: #eff6ff;
    --orange: #ea580c;
    --teal: #0d9488;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'DM Sans', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  .container {
    max-width: 1120px;
    margin: 0 auto;
    padding: 0 28px;
  }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0c4a6e 100%);
    padding: 48px 0 44px;
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 30% 20%, rgba(34,211,238,0.15) 0%, transparent 60%),
      radial-gradient(ellipse at 70% 80%, rgba(124,58,237,0.1) 0%, transparent 60%);
    pointer-events: none;
  }

  .hero::after {
    content: '';
    position: absolute;
    bottom: -1px; left: 0; right: 0;
    height: 40px;
    background: var(--bg);
    clip-path: ellipse(55% 100% at 50% 100%);
  }

  .hero-inner {
    position: relative;
    z-index: 1;
    text-align: center;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 5px 16px;
    border-radius: 100px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.15);
    font-size: 0.72rem;
    font-weight: 700;
    color: rgba(255,255,255,0.85);
    letter-spacing: 0.14em;
    text-transform: uppercase;
    margin-bottom: 18px;
    backdrop-filter: blur(8px);
  }

  .hero-badge .dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--cyan-mid);
    box-shadow: 0 0 8px var(--cyan-mid);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

  .hero h1 {
    font-family: 'Fraunces', serif;
    font-size: clamp(2rem, 4.5vw, 3.2rem);
    font-weight: 900;
    color: #fff;
    line-height: 1.15;
    margin-bottom: 12px;
  }

  .hero h1 span {
    background: linear-gradient(135deg, #22d3ee, #a78bfa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .hero p {
    font-size: 1.05rem;
    color: rgba(255,255,255,0.65);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ CONTROL BAR ‚îÄ‚îÄ */
  .control-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    flex-wrap: wrap;
    padding: 28px 0 8px;
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--bg-card);
    padding: 10px 20px;
    border-radius: 14px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
  }

  .control-group label {
    font-weight: 700;
    font-size: 0.85rem;
    color: var(--text-label);
    white-space: nowrap;
  }

  .control-group input[type=range] {
    -webkit-appearance: none;
    width: 180px;
    height: 6px;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--cyan), var(--violet));
    outline: none;
    cursor: pointer;
  }

  .control-group input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px; height: 22px;
    border-radius: 50%;
    background: #fff;
    border: 3px solid var(--cyan);
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    cursor: pointer;
    transition: transform 0.15s;
  }

  .control-group input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.12); }

  .step-count-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.3rem;
    font-weight: 800;
    color: var(--cyan);
    background: var(--cyan-light);
    width: 40px; height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .units-control input[type=number] {
    width: 90px;
    background: var(--bg-input);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 8px 12px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    text-align: center;
    outline: none;
    transition: all 0.2s;
  }

  .units-control input[type=number]:focus {
    border-color: var(--cyan);
    background: var(--cyan-light);
    box-shadow: 0 0 0 3px rgba(8,145,178,0.1);
  }

  /* ‚îÄ‚îÄ PIPELINE ‚îÄ‚îÄ */
  .pipeline-wrap {
    padding: 18px 0 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
    flex-wrap: wrap;
  }

  .pipe-step {
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .pipe-node {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 800;
    font-size: 0.7rem;
    position: relative;
    box-shadow: var(--shadow-sm);
    transition: transform 0.2s;
  }

  .pipe-node:hover { transform: scale(1.08); }

  .pipe-node .node-yield {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 600;
    opacity: 0.9;
    margin-top: 1px;
  }

  .pipe-arrow {
    font-size: 1rem;
    color: var(--border-strong);
    margin: 0 2px;
  }

  .pipe-units-label {
    font-size: 0.62rem;
    color: var(--text-muted);
    position: absolute;
    bottom: -16px;
    white-space: nowrap;
    font-weight: 600;
  }

  /* ‚îÄ‚îÄ DATA TABLE ‚îÄ‚îÄ */
  .table-section {
    margin: 30px 0 0;
    background: var(--bg-card);
    border-radius: 18px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    overflow: hidden;
  }

  .table-header-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: var(--bg-soft);
    border-bottom: 1px solid var(--border);
  }

  .table-header-bar h2 {
    font-size: 1rem;
    font-weight: 800;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .table-header-bar h2 .icon {
    font-size: 1.1rem;
  }

  .table-header-bar .legend {
    display: flex;
    gap: 16px;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted);
  }

  .legend-dot {
    width: 8px; height: 8px;
    border-radius: 3px;
    display: inline-block;
    margin-right: 4px;
    vertical-align: middle;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
  }

  .data-table thead th {
    padding: 12px 14px;
    font-size: 0.68rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    text-align: center;
    border-bottom: 2px solid var(--border);
    background: var(--bg-soft);
    white-space: nowrap;
  }

  .data-table thead th.input-col {
    color: var(--text-label);
    position: relative;
  }

  .data-table thead th.input-col::after {
    content: '‚úé';
    font-size: 0.6rem;
    margin-left: 4px;
    opacity: 0.5;
  }

  .data-table thead th:first-child {
    width: 54px;
    text-align: center;
  }

  .data-table tbody tr {
    transition: background 0.15s;
  }

  .data-table tbody tr:hover {
    background: rgba(8,145,178,0.03);
  }

  .data-table tbody tr:not(:last-child) td {
    border-bottom: 1px solid var(--border);
  }

  .data-table td {
    padding: 10px 12px;
    text-align: center;
    vertical-align: middle;
  }

  /* Step Number Pill */
  .step-pill {
    width: 34px; height: 34px;
    border-radius: 9px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 800;
    font-size: 0.8rem;
    color: #fff;
    margin: 0 auto;
  }

  /* Auto-calculated cell */
  .auto-cell {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-secondary);
    background: var(--bg-soft);
    border-radius: 8px;
    padding: 7px 10px;
    display: inline-block;
    min-width: 52px;
    border: 1px dashed var(--border);
  }

  /* Editable inputs */
  .edit-input {
    width: 72px;
    background: #fff;
    border: 2px solid var(--border);
    border-radius: 9px;
    padding: 8px 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
    text-align: center;
    outline: none;
    transition: all 0.2s;
  }

  .edit-input:focus {
    border-color: var(--cyan);
    background: var(--cyan-light);
    box-shadow: 0 0 0 3px rgba(8,145,178,0.1);
  }

  .edit-input.scrap-input:focus {
    border-color: var(--rose);
    background: var(--rose-light);
    box-shadow: 0 0 0 3px rgba(225,29,72,0.08);
  }

  .edit-input.rework-input:focus {
    border-color: var(--amber);
    background: var(--amber-light);
    box-shadow: 0 0 0 3px rgba(217,119,6,0.08);
  }

  /* Result badges */
  .result-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    font-weight: 700;
    padding: 6px 10px;
    border-radius: 8px;
    display: inline-block;
    min-width: 68px;
  }

  .result-badge.fty-badge {
    background: var(--cyan-light);
    color: var(--cyan);
    border: 1px solid rgba(8,145,178,0.15);
  }

  .result-badge.ipy-badge {
    background: var(--violet-light);
    color: var(--violet);
    border: 1px solid rgba(124,58,237,0.12);
  }

  .result-badge.poisson-badge {
    background: var(--amber-light);
    color: var(--amber);
    border: 1px solid rgba(217,119,6,0.12);
  }

  .result-badge.dpu-badge {
    background: var(--bg-soft);
    color: var(--text-secondary);
    border: 1px solid var(--border);
    font-size: 0.75rem;
  }

  /* ‚îÄ‚îÄ TOTALS PANEL ‚îÄ‚îÄ */
  .totals-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 14px;
    margin: 24px 0 0;
  }

  .total-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px 16px;
    text-align: center;
    box-shadow: var(--shadow-sm);
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }

  .total-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-3px);
  }

  .total-card .top-stripe {
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
  }

  .total-card .total-icon {
    font-size: 1.4rem;
    margin-bottom: 6px;
  }

  .total-card .total-label {
    font-size: 0.65rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .total-card .total-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1.2;
  }

  .total-card .total-formula {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.5;
    word-break: break-all;
  }

  .tc-cyan .top-stripe { background: linear-gradient(90deg, var(--cyan), var(--cyan-mid)); }
  .tc-cyan .total-value { color: var(--cyan); }

  .tc-violet .top-stripe { background: linear-gradient(90deg, var(--violet), var(--violet-mid)); }
  .tc-violet .total-value { color: var(--violet); }

  .tc-amber .top-stripe { background: linear-gradient(90deg, var(--amber), var(--amber-mid)); }
  .tc-amber .total-value { color: var(--amber); }

  .tc-emerald .top-stripe { background: linear-gradient(90deg, var(--emerald), #34d399); }
  .tc-emerald .total-value { color: var(--emerald); }

  .tc-rose .top-stripe { background: linear-gradient(90deg, var(--rose), #fb7185); }
  .tc-rose .total-value { color: var(--rose); }

  /* ‚îÄ‚îÄ WORKINGS ‚îÄ‚îÄ */
  .workings-section {
    margin: 28px 0 0;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 18px;
    box-shadow: var(--shadow-md);
    overflow: hidden;
  }

  .workings-header {
    padding: 16px 24px;
    background: var(--bg-soft);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
  }

  .workings-header h2 {
    font-size: 1rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .workings-header .toggle-icon {
    font-size: 1.2rem;
    color: var(--text-muted);
    transition: transform 0.3s;
  }

  .workings-header.open .toggle-icon {
    transform: rotate(180deg);
  }

  .workings-body {
    padding: 20px 24px;
    display: none;
  }

  .workings-body.show { display: block; }

  .step-working {
    background: var(--bg-soft);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 10px;
    border-left: 4px solid var(--cyan);
    transition: all 0.2s;
  }

  .step-working:hover { box-shadow: var(--shadow-sm); }

  .step-working:nth-child(even) { border-left-color: var(--violet); }
  .step-working.overall-working { border-left-color: var(--emerald); background: var(--emerald-light); }

  .step-working h3 {
    font-size: 0.78rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 8px;
    color: var(--text-label);
  }

  .formula-line {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    line-height: 2;
    color: var(--text-secondary);
  }

  .formula-line .lbl { color: var(--text-muted); font-weight: 600; }
  .formula-line .v-cyan { color: var(--cyan); font-weight: 700; }
  .formula-line .v-violet { color: var(--violet); font-weight: 700; }
  .formula-line .v-amber { color: var(--amber); font-weight: 700; }
  .formula-line .v-emerald { color: var(--emerald); font-weight: 700; }
  .formula-line .v-rose { color: var(--rose); font-weight: 700; }

  /* ‚îÄ‚îÄ LESSON ‚îÄ‚îÄ */
  .lesson-section {
    margin: 44px 0 56px;
  }

  .lesson-title {
    text-align: center;
    margin-bottom: 32px;
  }

  .lesson-title h2 {
    font-family: 'Fraunces', serif;
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--text-primary);
  }

  .lesson-title h2 span {
    background: linear-gradient(135deg, var(--cyan), var(--violet));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .lesson-title p {
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-top: 6px;
  }

  .lesson-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
    margin-bottom: 24px;
  }

  .lesson-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px 24px;
    box-shadow: var(--shadow-sm);
    transition: all 0.25s;
    position: relative;
  }

  .lesson-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .lesson-card .card-icon {
    width: 44px; height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin-bottom: 14px;
  }

  .lesson-card:nth-child(1) .card-icon { background: var(--cyan-light); }
  .lesson-card:nth-child(2) .card-icon { background: var(--violet-light); }
  .lesson-card:nth-child(3) .card-icon { background: var(--amber-light); }

  .lesson-card h3 {
    font-size: 1.05rem;
    font-weight: 800;
    margin-bottom: 2px;
  }

  .lesson-card:nth-child(1) h3 { color: var(--cyan); }
  .lesson-card:nth-child(2) h3 { color: var(--violet); }
  .lesson-card:nth-child(3) h3 { color: var(--amber); }

  .lesson-card .subtitle {
    font-size: 0.72rem;
    color: var(--text-muted);
    font-weight: 600;
    margin-bottom: 12px;
  }

  .lesson-card p {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--text-secondary);
  }

  .formula-box {
    background: var(--bg-soft);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    margin: 14px 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    text-align: center;
    line-height: 1.9;
    color: var(--text-primary);
  }

  .formula-box .note {
    color: var(--text-muted);
    font-size: 0.72rem;
  }

  /* Poisson card full-width */
  .poisson-card-wrap {
    margin-bottom: 24px;
  }

  .poisson-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    box-shadow: var(--shadow-sm);
    border-left: 4px solid var(--amber);
  }

  .poisson-card h3 {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--amber);
    margin-bottom: 4px;
  }

  .poisson-card .subtitle {
    font-size: 0.72rem;
    color: var(--text-muted);
    font-weight: 600;
    margin-bottom: 12px;
  }

  .poisson-card p {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--text-secondary);
  }

  /* Rework section */
  .rework-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }

  .rework-card .rework-header {
    padding: 20px 28px;
    background: linear-gradient(135deg, #fdf2f8, #fff1f2);
    border-bottom: 1px solid var(--border);
  }

  .rework-card .rework-header h3 {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--rose);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .rework-body {
    padding: 24px 28px;
  }

  .rework-body p {
    font-size: 0.9rem;
    line-height: 1.75;
    color: var(--text-secondary);
    margin-bottom: 12px;
  }

  .rework-body ul {
    list-style: none;
    padding: 0;
    margin: 14px 0;
  }

  .rework-body ul li {
    padding: 8px 0 8px 24px;
    position: relative;
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text-secondary);
  }

  .rework-body ul li::before {
    content: '';
    position: absolute;
    left: 0; top: 14px;
    width: 10px; height: 10px;
    border-radius: 3px;
  }

  .rework-body ul li:nth-child(1)::before { background: var(--cyan); }
  .rework-body ul li:nth-child(2)::before { background: var(--violet); }
  .rework-body ul li:nth-child(3)::before { background: var(--amber); }
  .rework-body ul li:nth-child(4)::before { background: var(--rose); }

  .comparison-table {
    width: 100%;
    margin: 18px 0;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 12px;
    overflow: hidden;
    font-size: 0.82rem;
    border: 1px solid var(--border);
  }

  .comparison-table th {
    background: var(--bg-soft);
    padding: 12px 16px;
    text-align: left;
    font-weight: 800;
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    border-bottom: 2px solid var(--border);
  }

  .comparison-table td {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    color: var(--text-secondary);
  }

  .comparison-table tr:last-child td { border-bottom: none; }
  .comparison-table td:first-child { font-weight: 700; }
  .hl-cyan { color: var(--cyan) !important; }
  .hl-violet { color: var(--violet) !important; }
  .hl-amber { color: var(--amber) !important; }

  .check { color: var(--emerald); font-weight: 800; }
  .cross { color: var(--text-muted); }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  .footer {
    text-align: center;
    padding: 24px 0 40px;
    font-size: 0.75rem;
    color: var(--text-muted);
    border-top: 1px solid var(--border);
  }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 900px) {
    .totals-grid { grid-template-columns: repeat(3, 1fr); }
    .lesson-grid { grid-template-columns: 1fr; }
    .data-table { font-size: 0.8rem; }
    .edit-input { width: 60px; padding: 6px; }
  }

  @media (max-width: 640px) {
    .totals-grid { grid-template-columns: 1fr 1fr; }
    .control-bar { flex-direction: column; gap: 12px; }
    .data-table thead th { font-size: 0.6rem; padding: 8px 6px; }
    .data-table td { padding: 8px 4px; }
    .edit-input { width: 50px; font-size: 0.75rem; }
    .result-badge { font-size: 0.72rem; padding: 4px 6px; min-width: 56px; }
  }

  /* Step colors */
  .sc-1{background:#0891b2;} .sc-2{background:#7c3aed;} .sc-3{background:#e11d48;} .sc-4{background:#059669;} .sc-5{background:#ea580c;}
  .sc-6{background:#0d9488;} .sc-7{background:#9333ea;} .sc-8{background:#d97706;} .sc-9{background:#2563eb;} .sc-10{background:#be185d;}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div class="container hero-inner">
    <div class="hero-badge"><span class="dot"></span> Lean Six Sigma ‚Äî Master Black Belt Tool</div>
    <h1>Process <span>Yield Calculator</span></h1>
    <p>Analyze FTY, IPY, and Rolled Throughput Yield across multi-step processes with the Poisson defect model (e<sup>‚àíDPU</sup>).</p>
  </div>
</div>

<div class="container">

  <!-- CONTROLS -->
  <div class="control-bar">
    <div class="control-group">
      <label>Process Steps:</label>
      <input type="range" id="stepSlider" min="1" max="10" value="4">
      <div class="step-count-badge" id="stepCountBadge">4</div>
    </div>
    <div class="control-group units-control">
      <label>Starting Units:</label>
      <input type="number" id="startingUnits" min="1" value="100">
    </div>
  </div>

  <!-- PIPELINE -->
  <div class="pipeline-wrap" id="pipeline"></div>

  <!-- DATA TABLE -->
  <div class="table-section">
    <div class="table-header-bar">
      <h2><span class="icon">üìä</span> Process Step Data</h2>
      <div class="legend">
        <span><span class="legend-dot" style="background:var(--cyan);"></span>FTY</span>
        <span><span class="legend-dot" style="background:var(--violet);"></span>IPY</span>
        <span><span class="legend-dot" style="background:var(--amber);"></span>Poisson Y</span>
      </div>
    </div>
    <div style="overflow-x:auto;">
    <table class="data-table">
      <thead>
        <tr>
          <th>Step</th>
          <th>Units In</th>
          <th class="input-col">Scrapped</th>
          <th class="input-col">Reworked</th>
          <th>Units Out</th>
          <th>DPU</th>
          <th>FTY</th>
          <th>IPY</th>
          <th>Y = e<sup>‚àíDPU</sup></th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    </div>
  </div>

  <!-- TOTALS -->
  <div class="totals-grid" id="totalsGrid">
    <div class="total-card tc-cyan">
      <div class="top-stripe"></div>
      <div class="total-icon">üìà</div>
      <div class="total-label">Rolled FTY</div>
      <div class="total-value" id="tFTY">‚Äî</div>
      <div class="total-formula" id="tFTYf"></div>
    </div>
    <div class="total-card tc-violet">
      <div class="top-stripe"></div>
      <div class="total-icon">üéØ</div>
      <div class="total-label">Rolled Throughput (RTP)</div>
      <div class="total-value" id="tRTP">‚Äî</div>
      <div class="total-formula" id="tRTPf"></div>
    </div>
    <div class="total-card tc-amber">
      <div class="top-stripe"></div>
      <div class="total-icon">üìê</div>
      <div class="total-label">Poisson Yield</div>
      <div class="total-value" id="tPoisson">‚Äî</div>
      <div class="total-formula" id="tPoissonf"></div>
    </div>
    <div class="total-card tc-emerald">
      <div class="top-stripe"></div>
      <div class="total-icon">üî¢</div>
      <div class="total-label">Total DPU</div>
      <div class="total-value" id="tDPU">‚Äî</div>
      <div class="total-formula" id="tDPUf"></div>
    </div>
    <div class="total-card tc-rose">
      <div class="top-stripe"></div>
      <div class="total-icon">üì¶</div>
      <div class="total-label">Final Units Out</div>
      <div class="total-value" id="tOut">‚Äî</div>
      <div class="total-formula" id="tOutf"></div>
    </div>
  </div>

  <!-- WORKINGS -->
  <div class="workings-section">
    <div class="workings-header" id="workingsToggle">
      <h2><span class="icon">üìê</span> Step-by-Step Workings &amp; Formulas</h2>
      <span class="toggle-icon">‚ñº</span>
    </div>
    <div class="workings-body" id="workingsBody"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- LESSON SECTION -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="lesson-section">
    <div class="lesson-title">
      <h2>Understanding <span>Yield Metrics</span></h2>
      <p>A Lean Six Sigma guide to the metrics that reveal your true process capability</p>
    </div>

    <div class="lesson-grid">
      <div class="lesson-card">
        <div class="card-icon">üìà</div>
        <h3>FTY ‚Äî First Time Yield</h3>
        <div class="subtitle">Also known as First Pass Yield (FPY)</div>
        <p>FTY measures the percentage of units that pass through a process step without being <strong>scrapped</strong>. It is the simplest yield metric ‚Äî but it has a critical blind spot: it completely ignores rework.</p>
        <div class="formula-box">
          FTY = (Units In ‚àí Scrapped) √∑ Units In<br>
          <span class="note">‚ö† Reworked units count as "good"</span>
        </div>
        <p>If 100 units enter and 5 are scrapped but 20 require rework, FTY reports 95%. The 20% rework cost is invisible ‚Äî this is the "hidden factory" that erodes margins.</p>
      </div>

      <div class="lesson-card">
        <div class="card-icon">üéØ</div>
        <h3>IPY ‚Äî Individual Process Yield</h3>
        <div class="subtitle">The rework-aware yield per step</div>
        <p>IPY improves on FTY by counting reworked units as failures. If a unit needed rework to pass, it was not right the first time ‚Äî and IPY reflects that reality.</p>
        <div class="formula-box">
          IPY = (Units In ‚àí Scrapped ‚àí Reworked) √∑ Units In<br>
          <span class="note">Both scrap and rework reduce yield</span>
        </div>
        <p>Same example: IPY = (100‚àí5‚àí20) √∑ 100 = <strong>75%</strong>. A dramatically different picture than 95%, and far more honest about true process capability. When multiplied across steps, this gives the Rolled Throughput Yield (RTP).</p>
      </div>

      <div class="lesson-card">
        <div class="card-icon">üè≠</div>
        <h3>RTP ‚Äî Rolled Throughput Yield</h3>
        <div class="subtitle">Also called RTY (Rolled Throughput Yield)</div>
        <p>RTP multiplies the IPY of every step to show the probability that a unit will traverse the <strong>entire</strong> process defect-free, with no rework at any stage.</p>
        <div class="formula-box">
          RTP = IPY‚ÇÅ √ó IPY‚ÇÇ √ó ‚Ä¶ √ó IPY‚Çô<br>
          <span class="note">Multiplicative ‚Äî small losses compound rapidly</span>
        </div>
        <p>Even with 95% IPY at each of 10 steps, the RTP drops to about 60%. This compounding effect is why RTP is the most powerful metric for exposing systemic waste across a value stream.</p>
      </div>
    </div>

    <!-- Poisson -->
    <div class="poisson-card-wrap">
      <div class="poisson-card">
        <h3>The Poisson Yield Formula ‚Äî Y = e<sup>‚àíDPU</sup></h3>
        <div class="subtitle">Using Euler's number to model defect probability</div>
        <p>When we know the average Defects Per Unit (DPU) at a step, the Poisson distribution models the probability that a unit has zero defects:</p>
        <div class="formula-box">
          DPU = Total Defects √∑ Total Units &nbsp;&nbsp;|&nbsp;&nbsp; Total Defects = Scrapped + Reworked<br>
          Y = e<sup>‚àíDPU</sup> &nbsp;‚âà&nbsp; 2.71828<sup>‚àíDPU</sup><br>
          <span class="note">e ‚âà 2.71828 (Euler's number) ‚Äî the base of natural logarithms</span>
        </div>
        <p>This method is especially powerful because it accounts for <em>multiple defects per unit</em> ‚Äî a unit reworked twice contributes differently than one reworked once. For the overall process, you can either multiply each step's Poisson yield, or compute e<sup>‚àí(total DPU)</sup>; both produce the same result since e<sup>‚àía</sup> √ó e<sup>‚àíb</sup> = e<sup>‚àí(a+b)</sup>.</p>
      </div>
    </div>

    <!-- Rework -->
    <div class="rework-card">
      <div class="rework-header">
        <h3>‚ö† Rework Considerations in the Formulas</h3>
      </div>
      <div class="rework-body">
        <p>How each metric treats rework is what fundamentally separates them ‚Äî and determines how honest they are about your process health:</p>
        <ul>
          <li><strong>FTY ignores rework entirely.</strong> A reworked unit that eventually passes is counted identically to one that passed perfectly the first time. This creates the dangerous "hidden factory" where rework costs, cycle time inflation, and resource consumption stay invisible to management.</li>
          <li><strong>IPY / RTP penalize rework.</strong> Any unit requiring rework is treated as a failure at that step. This exposes the hidden factory and gives a truthful measure of process capability for improvement prioritization.</li>
          <li><strong>The Poisson model (e<sup>‚àíDPU</sup>) counts every individual defect.</strong> If one unit has 3 defects found and corrected, it contributes 3 to the defect count ‚Äî not just 1. This provides the highest resolution view of process quality.</li>
          <li><strong>Rework inflates cycle time and cost without adding value.</strong> In Lean methodology, rework is pure waste (Muda). Even if a process shows 98% FTY, a low RTP reveals the true cost of poor quality ‚Äî every rework loop consumes labor, materials, machine time, and floor space.</li>
        </ul>

        <table class="comparison-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Counts Scrap</th>
              <th>Counts Rework</th>
              <th>Multi-Defect Sensitive</th>
              <th>Best Application</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="hl-cyan">FTY</td>
              <td><span class="check">‚úì</span></td>
              <td><span class="cross">‚úó</span></td>
              <td><span class="cross">‚úó</span></td>
              <td>Quick throughput check</td>
            </tr>
            <tr>
              <td class="hl-violet">IPY / RTP</td>
              <td><span class="check">‚úì</span></td>
              <td><span class="check">‚úì</span></td>
              <td><span class="cross">‚úó</span></td>
              <td>Process capability &amp; DMAIC</td>
            </tr>
            <tr>
              <td class="hl-amber">Y = e<sup>‚àíDPU</sup></td>
              <td><span class="check">‚úì</span></td>
              <td><span class="check">‚úì</span></td>
              <td><span class="check">‚úì</span></td>
              <td>Defect-sensitive / Six Sigma analysis</td>
            </tr>
          </tbody>
        </table>

        <p>In practice, organizations pursuing Six Sigma excellence rely on RTP and the Poisson yield method because they expose the true cost of quality. A process might show 95% FTY but only 60% RTP ‚Äî that gap represents the hidden factory: resources consumed by rework, retest, and repair that never appear in simple yield numbers but directly erode margin, delivery performance, and customer satisfaction.</p>
      </div>
    </div>
  </div>

  <div class="footer">
    Process Yield Calculator ‚Äî Lean Six Sigma Quality Metrics Tool
  </div>
</div>

<script>
const COLORS = ['#0891b2','#7c3aed','#e11d48','#059669','#ea580c','#0d9488','#9333ea','#d97706','#2563eb','#be185d'];

const slider = document.getElementById('stepSlider');
const countBadge = document.getElementById('stepCountBadge');
const startingUnitsInput = document.getElementById('startingUnits');
const tableBody = document.getElementById('tableBody');

let numSteps = 4;
let savedData = {};

slider.addEventListener('input', () => {
  numSteps = parseInt(slider.value);
  countBadge.textContent = numSteps;
  buildTable();
});

startingUnitsInput.addEventListener('input', calculate);

// Toggle workings
const wToggle = document.getElementById('workingsToggle');
const wBody = document.getElementById('workingsBody');
wToggle.addEventListener('click', () => {
  wToggle.classList.toggle('open');
  wBody.classList.toggle('show');
});

function buildTable() {
  // Save
  tableBody.querySelectorAll('tr').forEach((row, i) => {
    savedData[i] = {
      scrapped: row.querySelector('.scrap-input')?.value || '',
      reworked: row.querySelector('.rework-input')?.value || ''
    };
  });

  let html = '';
  for (let i = 0; i < numSteps; i++) {
    const sc = savedData[i]?.scrapped || '';
    const rw = savedData[i]?.reworked || '';
    html += `
      <tr>
        <td><div class="step-pill sc-${i+1}">${i+1}</div></td>
        <td><span class="auto-cell units-in-cell" data-step="${i}">‚Äî</span></td>
        <td><input class="edit-input scrap-input" type="number" min="0" placeholder="0" value="${sc}" data-step="${i}"></td>
        <td><input class="edit-input rework-input" type="number" min="0" placeholder="0" value="${rw}" data-step="${i}"></td>
        <td><span class="auto-cell units-out-cell" data-step="${i}">‚Äî</span></td>
        <td><span class="result-badge dpu-badge dpu-cell" data-step="${i}">‚Äî</span></td>
        <td><span class="result-badge fty-badge fty-cell" data-step="${i}">‚Äî</span></td>
        <td><span class="result-badge ipy-badge ipy-cell" data-step="${i}">‚Äî</span></td>
        <td><span class="result-badge poisson-badge poisson-cell" data-step="${i}">‚Äî</span></td>
      </tr>
    `;
  }
  tableBody.innerHTML = html;
  tableBody.querySelectorAll('input').forEach(inp => inp.addEventListener('input', calculate));
  calculate();
}

function calculate() {
  const startUnits = parseFloat(startingUnitsInput.value) || 0;
  const rows = tableBody.querySelectorAll('tr');
  const results = [];

  rows.forEach((row, i) => {
    const scrapped = parseFloat(row.querySelector('.scrap-input').value) || 0;
    const reworked = parseFloat(row.querySelector('.rework-input').value) || 0;
    const unitsIn = i === 0 ? startUnits : Math.max(0, results[i - 1].unitsOut);
    const unitsOut = Math.max(0, unitsIn - scrapped);
    const fty = unitsIn > 0 ? unitsOut / unitsIn : 0;
    const ipy = unitsIn > 0 ? Math.max(0, unitsIn - scrapped - reworked) / unitsIn : 0;
    const defects = scrapped + reworked;
    const dpu = unitsIn > 0 ? defects / unitsIn : 0;
    const poissonY = unitsIn > 0 ? Math.exp(-dpu) : 0;

    results.push({ unitsIn, scrapped, reworked, unitsOut, fty, ipy, dpu, poissonY, defects });

    row.querySelector('.units-in-cell').textContent = unitsIn > 0 ? unitsIn : '‚Äî';
    row.querySelector('.units-out-cell').textContent = unitsIn > 0 ? unitsOut : '‚Äî';
    row.querySelector('.dpu-cell').textContent = unitsIn > 0 ? dpu.toFixed(4) : '‚Äî';
    row.querySelector('.fty-cell').textContent = unitsIn > 0 ? (fty * 100).toFixed(2) + '%' : '‚Äî';
    row.querySelector('.ipy-cell').textContent = unitsIn > 0 ? (ipy * 100).toFixed(2) + '%' : '‚Äî';
    row.querySelector('.poisson-cell').textContent = unitsIn > 0 ? (poissonY * 100).toFixed(2) + '%' : '‚Äî';
  });

  const valid = results.filter(r => r.unitsIn > 0);
  if (valid.length === 0) {
    ['tFTY','tRTP','tPoisson','tDPU','tOut'].forEach(id => document.getElementById(id).textContent = '‚Äî');
    ['tFTYf','tRTPf','tPoissonf','tDPUf','tOutf'].forEach(id => document.getElementById(id).textContent = '');
    document.getElementById('workingsBody').innerHTML = '<p style="color:var(--text-muted);padding:8px;">Enter starting units and defect data above to see workings.</p>';
    buildPipeline(results);
    return;
  }

  const rFTY = valid.reduce((a, r) => a * r.fty, 1);
  const rRTP = valid.reduce((a, r) => a * r.ipy, 1);
  const sumDPU = valid.reduce((a, r) => a + r.dpu, 0);
  const pOverall = Math.exp(-sumDPU);
  const finalOut = results[results.length - 1].unitsOut;

  document.getElementById('tFTY').textContent = (rFTY * 100).toFixed(2) + '%';
  document.getElementById('tRTP').textContent = (rRTP * 100).toFixed(2) + '%';
  document.getElementById('tPoisson').textContent = (pOverall * 100).toFixed(2) + '%';
  document.getElementById('tDPU').textContent = sumDPU.toFixed(4);
  document.getElementById('tOut').textContent = finalOut;

  document.getElementById('tFTYf').textContent = valid.map(r => r.fty.toFixed(4)).join(' √ó ') + ' = ' + rFTY.toFixed(4);
  document.getElementById('tRTPf').textContent = valid.map(r => r.ipy.toFixed(4)).join(' √ó ') + ' = ' + rRTP.toFixed(4);
  document.getElementById('tPoissonf').textContent = `e^‚àí(${sumDPU.toFixed(4)}) = ${pOverall.toFixed(4)}`;
  document.getElementById('tDPUf').textContent = valid.map(r => r.dpu.toFixed(4)).join(' + ') + ' = ' + sumDPU.toFixed(4);
  document.getElementById('tOutf').textContent = `${startUnits} ‚Üí ${finalOut} (${startUnits > 0 ? ((finalOut/startUnits)*100).toFixed(1) : 0}% throughput)`;

  // Workings
  let wHTML = '';
  results.forEach((r, i) => {
    if (r.unitsIn <= 0) return;
    const goodFirst = Math.max(0, r.unitsIn - r.scrapped - r.reworked);
    wHTML += `
      <div class="step-working">
        <h3>Step ${i + 1}</h3>
        <div class="formula-line">
          <span class="lbl">Units In:</span> <span class="v-cyan">${r.unitsIn}</span> &nbsp;‚îÇ&nbsp;
          <span class="lbl">Scrapped:</span> <span class="v-rose">${r.scrapped}</span> &nbsp;‚îÇ&nbsp;
          <span class="lbl">Reworked:</span> <span class="v-amber">${r.reworked}</span> &nbsp;‚îÇ&nbsp;
          <span class="lbl">Units Out:</span> <span class="v-emerald">${r.unitsOut}</span>
        </div>
        <div class="formula-line" style="margin-top:4px;">
          <span class="lbl">FTY</span> = (${r.unitsIn} ‚àí ${r.scrapped}) √∑ ${r.unitsIn} = ${r.unitsOut} √∑ ${r.unitsIn} = <span class="v-cyan">${(r.fty * 100).toFixed(2)}%</span>
        </div>
        <div class="formula-line">
          <span class="lbl">IPY</span> = (${r.unitsIn} ‚àí ${r.scrapped} ‚àí ${r.reworked}) √∑ ${r.unitsIn} = ${goodFirst} √∑ ${r.unitsIn} = <span class="v-violet">${(r.ipy * 100).toFixed(2)}%</span>
        </div>
        <div class="formula-line">
          <span class="lbl">DPU</span> = (${r.scrapped} + ${r.reworked}) √∑ ${r.unitsIn} = ${r.defects} √∑ ${r.unitsIn} = <span class="v-amber">${r.dpu.toFixed(4)}</span>
        </div>
        <div class="formula-line">
          <span class="lbl">Poisson Y</span> = e<sup>‚àí${r.dpu.toFixed(4)}</sup> = 2.71828<sup>‚àí${r.dpu.toFixed(4)}</sup> = <span class="v-amber">${(r.poissonY * 100).toFixed(2)}%</span>
        </div>
      </div>
    `;
  });

  wHTML += `
    <div class="step-working overall-working">
      <h3>Overall Process Totals</h3>
      <div class="formula-line">
        <span class="lbl">Rolled FTY</span> = ${valid.map(r => r.fty.toFixed(4)).join(' √ó ')} = <span class="v-cyan">${(rFTY * 100).toFixed(2)}%</span>
      </div>
      <div class="formula-line">
        <span class="lbl">RTP (Rolled IPY)</span> = ${valid.map(r => r.ipy.toFixed(4)).join(' √ó ')} = <span class="v-violet">${(rRTP * 100).toFixed(2)}%</span>
      </div>
      <div class="formula-line">
        <span class="lbl">Total DPU</span> = ${valid.map(r => r.dpu.toFixed(4)).join(' + ')} = <span class="v-amber">${sumDPU.toFixed(4)}</span>
      </div>
      <div class="formula-line">
        <span class="lbl">Poisson RTY</span> = e<sup>‚àí${sumDPU.toFixed(4)}</sup> = <span class="v-amber">${(pOverall * 100).toFixed(2)}%</span>
      </div>
      <div class="formula-line" style="margin-top:6px;font-size:0.72rem;color:var(--text-muted);">
        Note: e<sup>‚àía</sup> √ó e<sup>‚àíb</sup> = e<sup>‚àí(a+b)</sup>, so the product of individual Poisson yields equals e<sup>‚àí(Total DPU)</sup>
      </div>
    </div>
  `;

  document.getElementById('workingsBody').innerHTML = wHTML;
  buildPipeline(results);
}

function buildPipeline(results) {
  const el = document.getElementById('pipeline');
  let html = '';

  // Starting units node
  html += `<div class="pipe-step">
    <div class="pipe-node" style="background:#334155;width:60px;height:50px;border-radius:12px;font-size:0.65rem;">
      IN<br><span class="node-yield">${results[0]?.unitsIn || '?'}</span>
    </div>
  </div>`;

  results.forEach((r, i) => {
    const color = COLORS[i % COLORS.length];
    const pct = r.unitsIn > 0 ? (r.ipy * 100).toFixed(0) + '%' : '?';
    html += `
      <div class="pipe-step">
        <span class="pipe-arrow">‚Üí</span>
        <div class="pipe-node" style="background:${color};box-shadow:0 3px 12px ${color}33;">
          S${i + 1}
          <span class="node-yield">${pct}</span>
          <span class="pipe-units-label">${r.unitsOut > 0 ? r.unitsOut + ' out' : ''}</span>
        </div>
      </div>
    `;
  });

  // Final output node
  const lastOut = results[results.length - 1]?.unitsOut ?? 0;
  html += `<div class="pipe-step">
    <span class="pipe-arrow">‚Üí</span>
    <div class="pipe-node" style="background:#059669;width:60px;height:50px;border-radius:12px;font-size:0.65rem;">
      OUT<br><span class="node-yield">${lastOut}</span>
    </div>
  </div>`;

  el.innerHTML = html;
}

// Init
buildTable();
// Auto-open workings
wToggle.classList.add('open');
wBody.classList.add('show');
</script>
</body>
</html>
